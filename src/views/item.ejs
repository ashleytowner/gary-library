<%- include('header') -%>
<div>
  <h1><%= sanitize(item.name) %></h1>
  <p style="display: flex; gap: 2rem; align-items: center;">
    <span><%= item.available ? "☑ Available" : `☒ Unavailable (On Loan to ${sanitize(item.username)})` %></span>
		<span><em>Owned By <%= sanitize(item.owner_name) %></em></span>
		<% if (isOwner) { %>
			<a class="button-like" href="/items/<%= item.id %>/edit">Edit Item</a>
		<% } %>
		<% if (!isOwner && !isRequested) { %>
			<button hx-post="/items/<%= item.id %>/request">Request to Borrow</button>
		<% } %>
  </p>
  <% if (item.image) { %>
		<a style="float: right" class="item-image-wrapper" href="/maximised/<%= item.image %>">
			<img height=150 src="/img/<%= item.image %>" />
		</a>
  <% } %>
  <% if (false && isOwner) { %>
    <form hx-put="/items/<%= item.id %>/image" enctype="multipart/form-data">
      <label for="image">Image (JPEG & WebP only)</label>
      <input type="file" name="image" accept=".jpeg,.jpg,.webp" />
      <button type="Submit">Change Image</button>
    </form>
  <% } %>
  <h2>Description</h2>
	<p><%- sanitize(md(item.description)) %></p>
  <% if (isOwner && !item.available) { %>
    <button hx-put="/loan/<%= item.loan_id %>/return" hx-swap="outerHTML">Mark As Returned</button>
  <% } %>
</div>

<h2>Tags</h2>
<% if (tags.length > 0) { %>
	<% for (const tag of tags) { %>
		<p><strong><%= sanitize(tag.tag) %></strong>: <%= sanitize(tag.value) %>
	<% } %>
<% } %>
<br />
<button hx-get="/items/<%= item.id %>/tag" hx-select="#page_body > *" hx-swap="outerHTML">Add Tag</button>

<% if (isOwner && requests.length > 0) { %>
  <h2>Requests</h2>
  <table>
    <tr>
      <th>User</th>
      <th>Date</th>
      <th>Actions</th>
    </tr>
    <% for (const row of requests) { %>
      <tr id="request-<%= row.id %>">
        <td><%= sanitize(row.username) %></td>
        <td><%= row.created_at %></td>
        <td>
          <button hx-target="#request-<%= row.id %>" hx-put="/requests/<%= row.id %>/approve">
            Approve
          </button>
          <button hx-target="#request-<%= row.id %>" hx-put="/requests/<%= row.id %>/reject">
            Reject
          </button>
        </td>
      </tr>
    <% } %>
  </table>
<% } %>
<%- include('footer') -%>
